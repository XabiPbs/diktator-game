<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Slotoken Slot Oyunu</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background-color: #111;
      color: #fff;
    }
    button {
      padding: 10px 20px;
      font-size: 18px;
      margin: 10px;
      border-radius: 10px;
      border: none;
      background-color: #e91e63;
      color: white;
      cursor: pointer;
    }
    .wallet {
      margin-top: 20px;
      font-size: 16px;
      color: #0f0;
    }
  </style>
</head>
<body>
  <h1>🎰 Slotoken Slot</h1>
  <p>Spin atmak için 1 <strong>SLT</strong> gerekir.</p>
  <div class="wallet">
    Cüzdan: <span id="walletAddress">Bağlı değil</span>
  </div>
  <button id="connectWallet">🔗 Cüzdan Bağla</button>
  <button id="spinBtn" disabled>🍀 Spin (1 SLT)</button>
  <div id="result"></div>

  <script>
    let web3;
    let userAccount;

    const SLT_TOKEN_ADDRESS = "0x1234567890abcdef1234567890abcdef12345678"; // Test Token
    const SLT_ABI = [
      {
        "constant": true,
        "inputs": [{"name": "_owner", "type": "address"}],
        "name": "balanceOf",
        "outputs": [{"name": "balance", "type": "uint256"}],
        "type": "function"
      },
      {
        "constant": false,
        "inputs": [
          {"name": "_to", "type": "address"},
          {"name": "_value", "type": "uint256"}
        ],
        "name": "transfer",
        "outputs": [{"name": "success", "type": "bool"}],
        "type": "function"
      }
    ];

    async function connectWallet() {
      if (window.ethereum) {
        try {
          const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
          userAccount = accounts[0];
          document.getElementById("walletAddress").textContent = userAccount;
          web3 = new Web3(window.ethereum);
          document.getElementById("spinBtn").disabled = false;
        } catch (err) {
          alert("Cüzdan bağlantısı reddedildi.");
        }
      } else {
        alert("Metamask tarayıcınızda yüklü değil.");
      }
    }

    async function playSlot() {
      const contract = new web3.eth.Contract(SLT_ABI, SLT_TOKEN_ADDRESS);
      const balance = await contract.methods.balanceOf(userAccount).call();
      const requiredSLT = web3.utils.toWei("1", "ether");

      if (parseInt(balance) >= requiredSLT) {
        await contract.methods.transfer("0xE87f61F042aFE174B93C10F2cCc15B65C51D8D47", requiredSLT)
          .send({ from: userAccount });
        document.getElementById("result").textContent = "🎉 Spin başarılı! Kazanç hesaplanıyor...";
      } else {
        document.getElementById("result").textContent = "😢 Yetersiz SLT bakiyesi.";
      }
    }

    document.getElementById("connectWallet").addEventListener("click", connectWallet);
    document.getElementById("spinBtn").addEventListener("click", playSlot);
  </script>
</body>
</html>
